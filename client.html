<html>
  <body>
    <div style="text-align: center">
      <input type="text" id="name"  value="josh" placeholder="Name"></input>
      <button onclick="ready()">Ready</button>
      <button onclick="start()">Start</button>
      <input type="text" id="card"  value="0" placeholder="Card num"></input>
      <button onclick="playCard()">Play Card</button>
      <select id="declare">
        <option value="clubs" selected="selected">clubs</option>
        <option value="diamonds">diamonds</option>
        <option value="hearts">hearts</option>
        <option value="spades">spades</option>
      </select>
      <button onclick="declare()">declare</button>
      <button onclick="bottomExchange()">bottomExchange</button>
      <br>
      <textarea id="game" rows="45" cols="100"></textarea>
      <br>
      <textarea id="cardsArea" rows="5" cols="100"></textarea>
    </div>
    <script>

      var ws = new WebSocket("ws://192.168.1.73:7000/ws");
      var player_num, cards, current_suit;

      var NUM = {
        "2": "two",
        "3": "three",
        "4": "four",
        "5": "five",
        "6": "six",
        "7": "seven",
        "8": "eight",
        "9": "nine",
        "10": "ten",
        "11": "jack",
        "12": "queen",
        "13": "king",
        "14": "ace",
        "15": "trump number",
        "16": "trump number trump suit",
        "17": "small joker",
        "18": "big joker"
      }

      function addToChat(message) {
            document.getElementById("game").value += message +"\n";
      };

      ws.onopen = function(event) {
        ws.send("hello");
        var name = document.getElementById("name").value;
        ws.send("ready " + name);
      };

      ws.onmessage = function(event) {
        var m = event.data.split(" ");
        switch(m[0]) {
          case "assign":
            player_num = m[1];
            break;
          case "cards":
            cards = JSON.parse(m[1]);
            renderCards();
            break;
          case "tricktype":
            current_suit = m[1];
            break;
          default:
            addToChat(event.data);
        }
      };

      function ready() {
        var name = document.getElementById("name").value;
        ws.send("ready " + name);
      }

      function start() {
        ws.send("start");
      }

      function playCard() {
        var cardNum = document.getElementById("card").value;
        var c = cards[cardNum];
        if(c.suit != current_suit && containsSuit(current_suit))
        {
          addToChat('Illegal move!');
        }
        else
        {
          ws.send("play " + cardNum);
          cards.splice(cardNum, 1);
          renderCards();
        }
      }

      function declare() {
        var e = document.getElementById("declare");
        var suit = e.options[e.selectedIndex].value;
        ws.send("declare " + player_num + " " + suit);
      }

      function bottomExchange() {
        ws.send("bottomExchange bottom info goes here");
      }

      function renderCards() {
        // TODO: use react for this later
        var value = "";
        for(var i = 0; i < cards.length; i++)
        {
          value += i + " " + NUM[cards[i].actual_num] + " " + cards[i].actual_suit + " ";
        }
        document.getElementById("cardsArea").value = value;
      }

      function containsSuit(suit) {
        // TODO: put into object later
        // TODO: replace with a counter for each type of card, decrease each time a card is played
        for(var i = 0; i < cards.length; i++) {
          if(cards[i].suit == suit) {
            return true;
          }
        }
        return false;
      }

    </script>
  </body>

</html>

